## Cookie与Session和Web Storage的区别

引言：

在前端面试中，Cookie与Web Storage的区别有时也有小伙伴会被问到，但是，问Cookie与Session的区别很少碰见，所以当年我第一次碰到的时候，就懵住了，我觉得有点奇怪，觉得这俩有什么好区别的，回来后上网搜了下，发现居然还真的有这方面的分享文章，好吧，是我孤陋寡闻了， 不过到目前为止我也只被问过一次，记录分享，仅供参考。



### Cookie与Web Storage的区别

下面我们先来看Cookie与Web Storage的区别

* 第一，使用的出发目的不同

  首先我们知道，使用Cookie与Web Storage的出发目的就不同，Cookie是用于跟踪用户状态的，用于客户端和服务端的状态验证，而Web Storage仅仅从字面上也可以看出来，它是为了客户端的存储目的而使用的。所以其实这两者的不同很容易区别。

* 第二，大小限制不同

  由于Cookie的使用目的主要在于跟踪状态，只需要存储用户状态、会话信息等少量数据，所以并不需要太大的存储空间，浏览器对单个域名下的Cookie限制比较小，大约是5kB，当超过限制后继续设置新的Cookie，会清除以前设置的Cookie来腾出空间；

  而Web Storage存储的空间相对较大，业界主流是5MB，当超出限制后继续添加存储内容，会导致抛出异常，所以使用时最好加上`try/catch`。

  当然针对不同浏览器，存储限制可能会有所不同，但整体而言Web Storage比Cookie的存储空间大得多。

* 第三，失效机制不同

  虽然浏览器会进行存储，但我们可以使用浏览器访问大量的网页，所以不可能无限制去存储大量的数据，所以浏览器也会进行存储管理。

  首先，这两者都可以直接主动删除，所以这里主要讲的是浏览器的自动管理。

  先说Cookie，Cookie一般在过期后会被浏览器清除，Cookie可以通过expires字段（GMT格式的时间）或者Max-age设置失效时间，过期后就会被清理，但如果某个Cookie没有设置expires，这个Cookie就被称为会话Cookie，当会话结束，也就是浏览器关闭后，该Cookie就会被清除。

  Web Storage也分为两种情况，LocalStorage和SessionStorage，LocalStorage理论上来说数据不会过期，是永久有效的，不会被清除，但在移动设备的浏览器或者app的webview中，可能会因为各种原因（比如强退app、内存不足等原因）被强制清除；而SessionStorage从字面上就可以看出是会话级别的存储，在关闭当前会话页后就会失效。

* 第四，网络通信

  由于Cookie的使用目的，它是会参与网络通信的，会被网络传输携带，每当发起HTTP请求，会自动将同域名下的Cookie添加到请求头中发送给服务器（当然我们也可以设置Secure使Cookie只在确保安全的请求中发送），所以如果Cookie内容太多，势必会增加网络开销；这也是很多Web应用将资源文件部署在CDN的其中一部分原因，如果与应用代码部署在同个域名下，则每次请求资源也会携带很多Cookie信息，浪费网络开销。

  但Web Storage仅仅只是单纯的前端本地存储。

* 第五，访问操作权限

  Cookie在网络中进行传输，既可以由服务端通过响应头`Set-Cookie`来设置，也可以由客户端`document.cookie`来设置，甚至服务端可以在`Set-Cookie`时设置HttpOnly，以防止Cookie信息被通过JS脚本窃取，来防止XSS攻击。

  而Web Storage是前端的本地存储，只由前端自己设置。

* 第六，浏览器支持情况

  由于Cookie出现的较早，所以兼容性比较好，而IE7及以下版本不支持Web Storage。

  另外Cookie的浏览器原生操作支持比较一般，只能通过`document.cookie = '' `去进行操作赋值，也不方便单个字段读取；当然对于这一点我们可以自己去封装操作或者使用第三方库。

  但Web Storage的话浏览器就有现成的API可以直接调用。

根据以上对比，可以看出来Cookie用途多一些，可以参与网络通信、偏好设置、适量存储，也可以做更灵活的配置来设置访问和操作权限；而Web Storage的优势就是可以存储相对较多内容，操作也更方便。

另外**Cookie的缺点也是一目了然的**：

第一，存储量太小，只有5KB；但这也可以理解，毕竟Cookie不是专门用来做存储的，

第二，每个域名下的Cookie个数有限，这个也可以理解，毕竟每次发起请求都会携带，如果不做限制，可能会导致请求体积过大，超过服务器的处理限制

第三，每次HTTP请求都会被携带发送到服务器，如果仅仅只是请求普通的资源，这就有点影响获取资源的效率

第四，浏览器原生操作支持一般，需要自己封装获取、设置和删除的方法；或者利用第三方的包。

**使用场景区别**：

既然Cookie和Web Storage有这么多不同，必然有他们各自适用的场景。

Cookie：

由于Cookie体积小，并不适合专门用于存储用途，主要还是适用于会话凭证、和简单的用户偏好设置等之类的操作。

Web Storage：

由于存储空间相对较大，又以字符串的形式存储，更适合专门用于客户端简单数据的存储。

那LocalStorage和SessionStorage又分别适合什么场景呢？

如果对数据安全性要求较高，或者存储的是一些与当前会话关联性较强的数据，比如我之前曾经做过一个需求，存在多条路径能跳转到某个页面，在这个页面点击返回时需要返回到路径的最前端，需要对路由信息进行记录，也就是这个路由信息与当前会话关联性较强，在这些情况下我们就可以将一些数据存储在SessionStorage中，在会话结束后自动清除，减少信息被窃取的风险，也避免存储空间被无效占用。

Cookie与Web Storage的对比就到这里了。



### Cookie与Session的区别

接下来来看Cookie和Session的区别。

Cookie与Session的共同点就在于两者都是会话技术，目的在于跟踪记录用户状态。

会话技术产生的原因在于，HTTP是无状态的协议，而某些场景服务端需要记录用户的状态，比如未登录状态下的购物车，需要识别具体的操作用户，服务端就为用户创建特定的Session，用于标识用户。因为要对用户进行跟踪，服务端需要将新创建的Session的id（JSESSIONID）返回给浏览器并设置为客户端的cookie，这样在客户端后续的请求中，服务端就能根据所携带的Cookie识别用户，从而达到跟踪用户状态的目的。

所以Cookie与Session的区别就在于以下几点：

第一，存储位置不同

Session存储在服务端，而Cookie存储在客户端；当服务端接收到一个请求时，无法知道这个请求对应的是哪个Session，但如果请求携带了Cookie，就能知道对应哪个Session。

第二，用途不完全相同

Session和Cookie是互相配合实现对用户状态的跟踪，但Cookie除了用户状态跟踪，还可以用于少量的数据存储等其他用途，所以Session只有服务端能设置，Cookie还可以通过客户端设置。Cookie的用途更多样一些。

第三，存储限制不同

浏览器会针对单个域名下的Cookie进行限制（大小约5KB，个数限制可能30或50个，不同浏览器的限制不同），这是因为Cookie会参与网络通信，过大过多的Cookie会影响传输效率，也可能超过服务器的处理限制；而Session本身没有大小限制，主要与服务器的内存大小有关，但Session保存在服务端上存在一段时间才会消失，所以Session过多会增加服务器的压力。

第四，安全性

Session不参与网络通信，自然少了被拦截的风险，但Cookie被HTTP请求携带，所以存在安全隐患，存在被拦截获取的风险。

当然我们也可以看出，当浏览器关闭后，会话Cookie和对应的Session都会失效。

其实我们也可以这么看，就是把Session认为是一个抽象概念，开发者为了实现中断和继续等操作，将user agent和server之间一对一的交互，抽象为“会话”，进而衍生出“会话状态”，这就是Session的概念；而Cookie是一个实际存在的东西，HTTP协议中定义在头部的字段，可以认为是Session跟踪状态的一种具体实现。



### 总结

最后来总结一下，就简单来看，Web Storage存在于前端，Session存在于服务端，而Cookie游走在客户端与服务端之间，就其实我也搞不太懂为啥总是要比来比去的区分。